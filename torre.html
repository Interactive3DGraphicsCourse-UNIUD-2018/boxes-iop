<!DOCTYPE html>
<html>
  <head>
    <title>Torre Struttura</title>

    <style>

    body {
      font-family: Monospace;
      background-color: #f0f0f0;
      margin: 0px;
      overflow: hidden;
    }

    canvas {
      width: 100%;
      height: 100%;
    }

    </style>
    <script src="lib/three.js"></script>
    <script src="lib/stats.min.js"></script>
    <script src="lib/Coordinates.js"></script>
    <script src="lib/OrbitControls.js"></script>

  </head>
  <body>
    <script>
      var scene, camera, renderer, controls, stats;
      var tower, tower_arm_base, tower_arm_top;

      var durataAnimazione, time;

      function Start() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 1000);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x3333aa);
        document.body.appendChild(renderer.domElement);

        camera.position.set(200,300,250);
        camera.lookAt(0,0,0);

        tower = new THREE.Object3D();
        tower_mid_arm_base = new THREE.Object3D();
        tower_mid_arm_top = new THREE.Object3D();
        tower_top_arm = new THREE.Object3D();
        Tower();
        tower.add(tower_mid_arm_base);
        tower.add(tower_mid_arm_top);
        tower.add(tower_top_arm);
        scene.add(tower);

        time = Date.now();
        durataAnimazione = 14000;

        //RIQUADRO FPS
        stats = new Stats();
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.top = '0px';
        document.body.appendChild(stats.domElement);

        //VISUALIZZO GLI ASSI
        Coordinates.drawAllAxes();

        //CONTROLLI ORBITALI
        controls = new THREE.OrbitControls(camera);
        controls.addEventListener('change', Render);
      }

      function Tower() {
        var altezza_tower = 200;
        var larghezza_tower = 50;
        var spessore_tower = 50;

        var tower_grey_material = new THREE.MeshBasicMaterial({ color: 0x888888, wireframe: true });

        //TORRE

        var tower_base_geometry = new THREE.BoxGeometry(larghezza_tower, altezza_tower/20, spessore_tower);
        var tower_column_geometry = new THREE.BoxGeometry(larghezza_tower/10, altezza_tower/5, spessore_tower/10);
        var tower_base_column_geometry = new THREE.BoxGeometry(larghezza_tower/2, altezza_tower/5, spessore_tower/2);

        var a = 0;
        var n = 5;
        var i = 0;
        var y = 0;
        var x = larghezza_tower/2 - larghezza_tower/20;
        var z = larghezza_tower/2 - larghezza_tower/20;
        while(i < n){
          if (a == 1) {
            var tower_base = new THREE.Mesh(tower_base_geometry, tower_grey_material);
            tower_base.position.set(0, y, 0);
            tower.add(tower_base);
            a = 0;
            y += altezza_tower/40 + altezza_tower/10;
            i ++;
          } else {
            var tower_column1 = new THREE.Mesh(tower_column_geometry, tower_grey_material);
            tower_column1.position.set(-x, y, -z);
            tower.add(tower_column1);

            var tower_column2 = new THREE.Mesh(tower_column_geometry, tower_grey_material);
            tower_column2.position.set(x, y, -z);
            tower.add(tower_column2);

            var tower_column3 = new THREE.Mesh(tower_column_geometry, tower_grey_material);
            tower_column3.position.set(x, y, z);
            tower.add(tower_column3);

            var tower_column4 = new THREE.Mesh(tower_column_geometry, tower_grey_material);
            tower_column4.position.set(-x, y, z);
            tower.add(tower_column4);

            var tower_base_column = new THREE.Mesh(tower_base_column_geometry, tower_grey_material);
            tower_base_column.position.set(0, y, 0);
            tower.add(tower_base_column);

            a = 1;
            y += altezza_tower/10 + altezza_tower/40;
          }
        }

        //BRACCIA DELLA TORRE

        //BRACCIO DI MEZZO
        y = altezza_tower/5 *2 + altezza_tower/10 *2 + altezza_tower/20 *3;
        x = larghezza_tower;
        z = larghezza_tower/2 - altezza_tower/30;
        var mid_arm_base_geometry = new THREE.BoxGeometry(larghezza_tower, altezza_tower/15, altezza_tower/15);
        tower_mid_arm_base = new THREE.Mesh(mid_arm_base_geometry, tower_grey_material);
        tower_mid_arm_base.position.set(x, y, z);
        tower.add(tower_mid_arm_base);

        x += larghezza_tower;

        var mid_arm_top_geometry = new THREE.BoxGeometry(larghezza_tower, altezza_tower/20, altezza_tower/20);
        tower_mid_arm_top = new THREE.Mesh(mid_arm_top_geometry, tower_grey_material);
        tower_mid_arm_top.position.set(x, y, z);
        tower.add(tower_mid_arm_top);

        //BRACCIO IN CIMA
        y = altezza_tower/20 *5 + altezza_tower/5 *4 + altezza_tower/10 + altezza_tower/40;
        x = (larghezza_tower * 2 + larghezza_tower/2)/2;
        z = 0;
        var top_arm_geometry = new THREE.BoxGeometry(larghezza_tower * 2 + larghezza_tower/2, altezza_tower/20, altezza_tower/20);
        tower_top_arm1 = new THREE.Mesh(top_arm_geometry, tower_grey_material);
        tower_top_arm1.position.set(x, y, z);
        tower_top_arm.add(tower_top_arm1);

        x = 0;
        y = altezza_tower/20 *5 + altezza_tower/5 *4 + altezza_tower/10 + altezza_tower/40;
        z = 0;
        var alfa = 0;
        n = 90;
        var arm_connections_geometry = new THREE.BoxGeometry(altezza_tower/30, altezza_tower/20, altezza_tower/30);
        while (alfa < n) {
          var tower_arm_connection = new THREE.Mesh(arm_connections_geometry, tower_grey_material);
          tower_arm_connection.position.set(x, y, z);
          tower_arm_connection.rotation.y = Math.PI * alfa / 180;
          tower_top_arm.add(tower_arm_connection);

          var shuttle_arm_connection = new THREE.Mesh(arm_connections_geometry, tower_grey_material);
          shuttle_arm_connection.position.set((larghezza_tower * 2 + larghezza_tower/2), (y - altezza_tower/40), z);
          shuttle_arm_connection.rotation.y = Math.PI * alfa / 180;
          tower_top_arm.add(shuttle_arm_connection);

          alfa += 15;
        }
        tower.add(tower_top_arm);

        //COSTRUZIONE PUNTA DELLA TORRE
        var d = 3;
        i = 0;
        var raggio = altezza_tower/30;
        var altezza = altezza_tower/5;
        y = altezza_tower/20 *5 + altezza_tower/5 *4 + altezza_tower/10 + altezza_tower/20 + altezza_tower/20;
        while (i < d) {
          var tower_punta_geometry = new THREE.BoxGeometry(raggio, altezza, raggio);
          alfa = 0;
          while (alfa < n) {
            var tower_punta = new THREE.Mesh(tower_punta_geometry, tower_grey_material);
            tower_punta.position.set(x, y, z);
            tower_punta.rotation.y = Math.PI * alfa / 180;
            tower.add(tower_punta);
            alfa += 15;
          }
          raggio -= altezza_tower/60;
          altezza -= altezza_tower/30;
          y += altezza;
          i ++;

        }
      }

      function Arm_detouchment() {
        var currentTime = Date.now();
        if (currentTime - time < durataAnimazione) {
          tower_top_arm.rotation.y -= Math.PI * 0.1 /180;
          tower_mid_arm_top.position.x -= 0.05;
        }
      }

      function Update() {
        requestAnimationFrame(Update);
        controls.update();
        stats.update();

        Render();
      }

      function Render() {
        renderer.render(scene, camera);
        Arm_detouchment();
      }

      Start();
      Update();
    </script>
  </body>
</html>
