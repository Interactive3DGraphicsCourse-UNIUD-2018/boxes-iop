<!DOCTYPE html>
<html>
  <head>
    <title>Space Shuttle tests struttura</title>

    <style>

    body {
      font-family: Monospace;
      background-color: #f0f0f0;
      margin: 0px;
      overflow: hidden;
    }

    canvas {
      width: 100%;
      height: 100%;
    }

  </style>
  <script src="lib/three.js"></script>
  <script src="lib/stats.min.js"></script>
  <script src="lib/Coordinates.js"></script>
  <script src="lib/OrbitControls.js"></script>

</head>
<body>
  <script>
    var scene, camera, renderer, controls, stats;
    var shuttle, external_tank, razzo_dx, razzo_sx;
    var larghezza_shuttle, altezza_shuttle, spessore_shuttle;

    function Start() {
      // chiamo le funzioni di costruzione del paesaggio e dello space shuttle
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.01, 1000);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0x3333aa);
      document.body.appendChild(renderer.domElement);

      camera.position.set(75,100,150);
      camera.lookAt( new THREE.Vector3(0,0,0));
        
      //dimensioni del blocco centrale, su cui vengono proporzionate tutte le altre compoinenti
      larghezza_shuttle = 30;
      altezza_shuttle = 100;
      spessore_shuttle = 15;

      shuttle = new THREE.Object3D();
      Shuttle(); //costruisce lo shuttle comprensivo di ali e propulsori sottostanti

      external_tank = new THREE.Object3D();
      External_tank(); //costruisce il serbatoio centrale
      shuttle.add(external_tank);

      //costruzione dei razzi destro e sinistro, pos serve a distinguerli al momento di posizionarli nella funzione Razzo()
      var pos = 0;
      razzo_dx = new THREE.Object3D();
      Razzo(razzo_dx, pos);
      shuttle.add(razzo_dx);

      pos = 1;
      razzo_sx = new THREE.Object3D();
      Razzo(razzo_sx, pos);
      shuttle.add(razzo_sx);

//      flames_group = new THREE.Object3D();

      scene.add(shuttle);

      time = Date.now();
      durataAnimazione = 14000;

      //RIQUADRO FPS
      stats = new Stats();
      stats.domElement.style.position = 'absolute';
      stats.domElement.style.top = '0px';
      document.body.appendChild(stats.domElement);

      //VISUALIZZO GLI ASSI
      Coordinates.drawAllAxes();

      //CONTROLLI ORBITALI
      controls = new THREE.OrbitControls(camera);
      controls.addEventListener('change', Render);

    }

    function Shuttle() {
      var white_material = new THREE.MeshBasicMaterial({ color: 0xfcfcfc, wireframe: false });
      var black_material = new THREE.MeshBasicMaterial({ color: 0x000000, wireframe: false });
      var grey_material = new THREE.MeshBasicMaterial({ color: 0x222222, wireframe: false });

      // COSTRUZIONE DEL CORPO DELLO SHUTTLE
      var base_geometry = new THREE.BoxGeometry(larghezza_shuttle, altezza_shuttle, spessore_shuttle);
      var base_shuttle = new THREE.Mesh(base_geometry, white_material);
      shuttle.add(base_shuttle);

      var base_geometry2 = new THREE.BoxGeometry(larghezza_shuttle-10, altezza_shuttle, spessore_shuttle/4);
      var base_shuttle2 = new THREE.Mesh(base_geometry2, white_material);
      base_shuttle2.position.set(0, 0, spessore_shuttle/2 + spessore_shuttle/8);
      shuttle.add(base_shuttle2);

      var base_geometry3 = new THREE.BoxGeometry(larghezza_shuttle-20, altezza_shuttle, spessore_shuttle/4);
      var base_shuttle3 = new THREE.Mesh(base_geometry3, white_material);
      base_shuttle3.position.set(0, 0, spessore_shuttle/2 + spessore_shuttle/4 + spessore_shuttle/8);
      shuttle.add(base_shuttle3);

      //costruzione della punta dello shuttle
      var base_punta_geometry = new THREE.BoxGeometry(larghezza_shuttle, altezza_shuttle/15, spessore_shuttle/4 * 3);
      var base_punta_shuttle = new THREE.Mesh(base_punta_geometry, white_material);
      base_punta_shuttle.position.set(0, altezza_shuttle/2 + altezza_shuttle/30, -spessore_shuttle/8);
      shuttle.add(base_punta_shuttle);

      var black_punta_geometry = new THREE.BoxGeometry(larghezza_shuttle, altezza_shuttle + altezza_shuttle/15, spessore_shuttle/4);
      var black_punta_shuttle = new THREE.Mesh(black_punta_geometry, black_material);
      black_punta_shuttle.position.set(0, altezza_shuttle/30, - spessore_shuttle/8 *5);
      shuttle.add(black_punta_shuttle);

      var base_punta2_geometry = new THREE.BoxGeometry(larghezza_shuttle-20, altezza_shuttle/30, spessore_shuttle/4);
      var base_punta2 = new THREE.Mesh(base_punta2_geometry, white_material);
      base_punta2.position.set(0, altezza_shuttle/2 + altezza_shuttle/60, spessore_shuttle/2 + spessore_shuttle/8);
      shuttle.add(base_punta2);

      var base_punta3_geometry = new THREE.BoxGeometry(larghezza_shuttle-20, altezza_shuttle/15, spessore_shuttle/4);
      var base_punta3 = new THREE.Mesh(base_punta3_geometry, black_material);
      base_punta3.position.set(0, altezza_shuttle/2 + altezza_shuttle/30, spessore_shuttle/2 - spessore_shuttle/8);
      shuttle.add(base_punta3);

      var base_punta4_geometry = new THREE.BoxGeometry(larghezza_shuttle-30, altezza_shuttle/30, spessore_shuttle/4);
      var base_punta4 = new THREE.Mesh(base_punta4_geometry, white_material);
      base_punta4.position.set(0, altezza_shuttle/2 + altezza_shuttle/60, spessore_shuttle/2 + spessore_shuttle/4 + spessore_shuttle/8);
      shuttle.add(base_punta4);

      var base_punta5 = new THREE.Mesh(base_punta4_geometry, black_material);
      base_punta5.position.set(0, altezza_shuttle/2 + altezza_shuttle/15 + altezza_shuttle/60, spessore_shuttle/8 * 3);
      shuttle.add(base_punta5);

      var base_punta6 = new THREE.Mesh(base_punta4_geometry, white_material);
      base_punta6.position.set(0, altezza_shuttle/2 + altezza_shuttle/30 + altezza_shuttle/60, spessore_shuttle/4 + spessore_shuttle/8 * 3);
      shuttle.add(base_punta6);

      var n = 3;
      var i = 0;
      var y = altezza_shuttle/2 + altezza_shuttle/15 + altezza_shuttle/60;
      var lato = larghezza_shuttle-20;
      while (i < n){
        var geometry = new THREE.BoxGeometry(lato, altezza_shuttle/30, spessore_shuttle/4);
        var block_punta = new THREE.Mesh(geometry, white_material);
        block_punta.position.set(0, y, spessore_shuttle/8);
        y += altezza_shuttle/30;
        lato -= 7;
        shuttle.add(block_punta);
        i++;
      }*/
        
      var y = altezza_shuttle/2 + altezza_shuttle/15 + altezza_shuttle/60;
      var lato = larghezza_shuttle-20;
      for (var i = 0; i < 3; i++) {
        var geometry = new THREE.BoxGeometry(lato, altezza_shuttle/30, spessore_shuttle/4);
        var block_punta = new THREE.Mesh(geometry, white_material);
        block_punta.position.set(0, y, spessore_shuttle/8);
        y += altezza_shuttle/30;
        lato -= 7;
        shuttle.add(block_punta);
      }

      i = 0;
      n = 4;
      y = altezza_shuttle/2 + altezza_shuttle/15 + altezza_shuttle/60;
      lato = larghezza_shuttle-10;
      while (i < n){
        var geometry = new THREE.BoxGeometry(lato, altezza_shuttle/30, spessore_shuttle/4);
        var block_punta = new THREE.Mesh(geometry, white_material);
        block_punta.position.set(0, y, - spessore_shuttle/8);
        y += altezza_shuttle/30;
        lato -= 7;
        shuttle.add(block_punta);
        i++;
      }

      i = 0;
      n = 5;
      y = altezza_shuttle/2 + altezza_shuttle/15 + altezza_shuttle/60;
      lato = larghezza_shuttle;
      while (i < n){
        var geometry = new THREE.BoxGeometry(lato, altezza_shuttle/30, spessore_shuttle/4);
        var block_punta = new THREE.Mesh(geometry, white_material);
        var base_block_punta = new THREE.Mesh(geometry, black_material);
        block_punta.position.set(0, y, - spessore_shuttle/8 *3);
        base_block_punta.position.set(0, y, - spessore_shuttle/8 *5)
        y += altezza_shuttle/30;
        lato -= 7;
        shuttle.add(block_punta);
        shuttle.add(base_block_punta);
        i++;
      }

      //COSTRUZIONE ALI

      //ALI LATERALI
      var larghezza_ala = larghezza_shuttle;
      y = altezza_shuttle/20;
      i = altezza_shuttle/2 - (y/2);
      var x = larghezza_shuttle/2 + larghezza_ala/2 + larghezza_ala/5;
      var decr = larghezza_ala/(i/y);
      while (i > 0) {
        var ala_geometry = new THREE.BoxGeometry(larghezza_ala, y, spessore_shuttle/8);
        var ala_white_dx = new THREE.Mesh(ala_geometry, white_material);
        var ala_black_dx = new THREE.Mesh(ala_geometry, black_material);
        ala_white_dx.position.set( x, -i, - spessore_shuttle/8 *4);
        ala_black_dx.position.set( x, -i, - spessore_shuttle/8 *5);
        shuttle.add(ala_white_dx);
        shuttle.add(ala_black_dx);

        var ala_white_sx = new THREE.Mesh(ala_geometry, white_material);
        var ala_black_sx = new THREE.Mesh(ala_geometry, black_material);
        ala_white_sx.position.set( -x, -i, - spessore_shuttle/8 *4);
        ala_black_sx.position.set( -x, -i, - spessore_shuttle/8 *5);
        shuttle.add(ala_white_sx);
        shuttle.add(ala_black_sx);

        larghezza_ala -= decr;
        x -= decr/2;
        i -= y;
      }

      var geometry_ala1 = new THREE.BoxGeometry(larghezza_shuttle/10, altezza_shuttle/3 *2, spessore_shuttle/8);
      var white_ala1_dx = new THREE.Mesh(geometry_ala1, white_material);
      var black_ala1_dx = new THREE.Mesh(geometry_ala1, black_material);
      var white_ala1_sx = new THREE.Mesh(geometry_ala1, white_material);
      var black_ala1_sx = new THREE.Mesh(geometry_ala1, black_material);
      white_ala1_dx.position.set(x + larghezza_ala/2, -(altezza_shuttle/2 - altezza_shuttle/3), - spessore_shuttle/8 *4);
      black_ala1_dx.position.set(x + larghezza_ala/2, -(altezza_shuttle/2 - altezza_shuttle/3), - spessore_shuttle/8 *5);
      white_ala1_sx.position.set(-(x + larghezza_ala/2), -(altezza_shuttle/2 - altezza_shuttle/3), - spessore_shuttle/8 *4);
      black_ala1_sx.position.set(-(x + larghezza_ala/2), -(altezza_shuttle/2 - altezza_shuttle/3), - spessore_shuttle/8 *5);
      shuttle.add(white_ala1_dx);
      shuttle.add(black_ala1_dx);
      shuttle.add(white_ala1_sx);
      shuttle.add(black_ala1_sx);

      var geometry_ala2 = new THREE.BoxGeometry(larghezza_shuttle/10, altezza_shuttle/4 * 3 + altezza_shuttle/8, spessore_shuttle/8);
      var white_ala2_dx = new THREE.Mesh(geometry_ala2, white_material);
      var black_ala2_dx = new THREE.Mesh(geometry_ala2, black_material);
      var white_ala2_sx = new THREE.Mesh(geometry_ala2, white_material);
      var black_ala2_sx = new THREE.Mesh(geometry_ala2, black_material);
      white_ala2_dx.position.set(x - (larghezza_shuttle/10 - larghezza_ala/2), -(altezza_shuttle/2 - (altezza_shuttle/4 * 3 + altezza_shuttle/8) /2), - spessore_shuttle/8 *4);
      black_ala2_dx.position.set(x - (larghezza_shuttle/10 - larghezza_ala/2), -(altezza_shuttle/2 - (altezza_shuttle/4 * 3 + altezza_shuttle/8) /2), - spessore_shuttle/8 *5);
      white_ala2_sx.position.set(-(x - (larghezza_shuttle/10 - larghezza_ala/2)), -(altezza_shuttle/2 - (altezza_shuttle/4 * 3 + altezza_shuttle/8) /2), - spessore_shuttle/8 *4);
      black_ala2_sx.position.set(-(x - (larghezza_shuttle/10 - larghezza_ala/2)), -(altezza_shuttle/2 - (altezza_shuttle/4 * 3 + altezza_shuttle/8) /2), - spessore_shuttle/8 *5);
      shuttle.add(white_ala2_dx);
      shuttle.add(black_ala2_dx);
      shuttle.add(white_ala2_sx);
      shuttle.add(black_ala2_sx);

      //ALA DORSALE
      n = 5;
      i = 0;
      larghezza_ala = altezza_shuttle/4;
      lato = altezza_shuttle/20;
      y = altezza_shuttle/5 * 2;
      var z = spessore_shuttle/2 + spessore_shuttle/4 + spessore_shuttle/4 + lato/2;
      while (i < n) {
      var ala_front_white_geometry = new THREE.BoxGeometry(lato, larghezza_ala, lato);
      var ala_front_white = new THREE.Mesh(ala_front_white_geometry, white_material);

      var ala_front_black_geometry = new THREE.BoxGeometry(lato, lato + lato/4, lato);
      var ala_front_black = new THREE.Mesh(ala_front_black_geometry, black_material);

      ala_front_white.position.set(0, -y, z);
      ala_front_black.position.set(0, -((y - larghezza_ala/2) - (lato/2 + lato/8)), z);
      shuttle.add(ala_front_white);
      shuttle.add(ala_front_black);
      larghezza_ala -= lato/2;
      y += lato;
      z += lato;
      i ++;
      }

      //COSTRUZIONE PROPULSORI

      alfa = 0;
      var h = 3;
      n = 90;
      while (alfa < n) {
        i = 0;
        larghezza_propulsori_temp = larghezza_shuttle/3;
        altezza_propulsori_temp = altezza_shuttle/30;
        spessore_propulsori_temp = larghezza_shuttle/3;
        y = altezza_shuttle/2 + altezza_propulsori_temp * h - altezza_propulsori_temp/2;
        while (i < h) {
          var propulsori_geometry = new THREE.BoxGeometry(larghezza_propulsori_temp, altezza_propulsori_temp, spessore_propulsori_temp);

          var mesh_propulsori1 = new THREE.Mesh(propulsori_geometry, grey_material);
          mesh_propulsori1.position.set(- larghezza_shuttle/3, -y, - spessore_shuttle/4);
          mesh_propulsori1.rotation.y = Math.PI * alfa / 180;
          shuttle.add(mesh_propulsori1);

          var mesh_propulsori2 = new THREE.Mesh(propulsori_geometry, grey_material);
          mesh_propulsori2.position.set(+ larghezza_shuttle/3, -y, - spessore_shuttle/4);
          mesh_propulsori2.rotation.y = Math.PI * alfa / 180;
          shuttle.add(mesh_propulsori2);

          var mesh_propulsori3 = new THREE.Mesh(propulsori_geometry, grey_material);
          mesh_propulsori3.position.set(0, -y, + larghezza_shuttle/4);
          mesh_propulsori3.rotation.y = Math.PI * alfa / 180;
          shuttle.add(mesh_propulsori3);

          larghezza_propulsori_temp -= larghezza_shuttle/20;
          spessore_propulsori_temp -= larghezza_shuttle/20;
          y -= altezza_propulsori_temp;
          i ++;
        }
        alfa += 15;
      }
    }

    function External_tank() {
      //COSTRUZIONE SERBATOIO
      var larghezza_tank = larghezza_shuttle;
      var altezza_tank = altezza_shuttle*1.3; //1.5 risulta troppo alto
      var spessore_tank = spessore_shuttle;

      var orange_material = new THREE.MeshBasicMaterial({ color: 0xff8100, wireframe: false });

      var tank_base_geometry = new THREE.BoxGeometry(larghezza_tank, altezza_tank, spessore_tank);


      var n = 180;
      var alfa = 0;
      while (alfa < n) {
        var external_tank_base = new THREE.Mesh(tank_base_geometry, orange_material);
        external_tank_base.position.set(0, -altezza_shuttle/3 + 3*altezza_shuttle/5, 0);  //altezza_shuttle/3 alternativa valida per y   y= mesh_propulsori1.position.y + altezza_tank/2
        external_tank_base.rotation.y = Math.PI * alfa / 180;
        external_tank.add(external_tank_base);
        alfa += 15;
      }

      n = 180;
      alfa = 0;
      var h = 6;
      while (alfa < n) {
        i = 0;
        larghezza_tank_temp = larghezza_tank;
        altezza_tank_temp = altezza_tank/10;
        spessore_tank_temp = spessore_tank;
        y = external_tank_base.position.y + altezza_tank/2 + altezza_tank_temp/2;
        while (i < h) {
          var tank_punta_geometry = new THREE.BoxGeometry(larghezza_tank_temp, altezza_tank_temp, spessore_tank_temp);

          var external_tank_punta = new THREE.Mesh(tank_punta_geometry, orange_material);
          external_tank_punta.position.set(0, y, external_tank_base.position.z);
          external_tank_punta.rotation.y = Math.PI * alfa / 180;
          external_tank.add(external_tank_punta);
          larghezza_tank_temp -= larghezza_tank/5;
          spessore_tank_temp -= spessore_tank/5;
          altezza_tank_temp -= altezza_tank_temp/5;
          y += altezza_tank_temp;
          i ++;
        }
        alfa += 15;
      }
      external_tank.position.set(external_tank.position.x, external_tank.position.y, -spessore_shuttle*2);
    }

    function Razzo(razzo, pos) {
      var white_material = new THREE.MeshBasicMaterial({ color: 0xfcfcfc, wireframe: false });

      var larghezza_razzo = larghezza_shuttle/2;
      var altezza_razzo = altezza_shuttle*1.4;
      var spessore_razzo = spessore_shuttle;

      var razzo_base_geometry = new THREE.BoxGeometry(larghezza_razzo, altezza_razzo, spessore_razzo);

      var n = 90;
      var alfa = 0;

      while (alfa < n) {
        var razzo_base = new THREE.Mesh(razzo_base_geometry, white_material);
        razzo_base.position.set(0, 0, 0);
        razzo_base.rotation.y = Math.PI * alfa / 180;
        razzo.add(razzo_base);

        alfa += 15;
      }

      alfa = 0;
      var h = 6;
      while (alfa < n) {
        var i = 0;
        larghezza_razzo_temp = larghezza_razzo;
        altezza_razzo_temp = altezza_razzo/20;
        spessore_razzo_temp = spessore_razzo;
        y = razzo_base.position.y + altezza_razzo/2 + altezza_razzo_temp/2;
        while (i < h) {
          var razzo_punta_geometry = new THREE.BoxGeometry(larghezza_razzo_temp, altezza_razzo_temp, spessore_razzo_temp);

          var razzo_punta = new THREE.Mesh(razzo_punta_geometry, white_material);
          razzo_punta.position.set(razzo_base.position.x, y, razzo_base.position.z);
          razzo_punta.rotation.y = Math.PI * alfa / 180;
          razzo.add(razzo_punta);

          larghezza_razzo_temp -= larghezza_razzo/5;
          spessore_razzo_temp -= spessore_razzo/5;
          altezza_razzo_temp -= altezza_razzo_temp/5;
          y += altezza_razzo_temp;
          i ++;
        }
        alfa += 15;
      }

      alfa = 0;
      var h = 3;
      while (alfa < n) {
      i = 0;
      var d = 0;
      larghezza_razzo_temp = larghezza_razzo;
      spessore_razzo_temp = spessore_razzo;
      altezza_razzo_temp = altezza_razzo/50;
      y = razzo_base.position.y - altezza_razzo/2 - altezza_razzo_temp/2 - altezza_razzo_temp*(h - 1)*2;
      while (d < 2) {
        while (i < h) {
          var razzo_propulsori_geometry = new THREE.BoxGeometry(larghezza_razzo_temp, altezza_razzo_temp, spessore_razzo_temp);

          var razzo_propulsori = new THREE.Mesh(razzo_propulsori_geometry, white_material);
          razzo_propulsori.position.set(razzo_base.position.x, y, razzo_base.position.z);
          razzo_propulsori.rotation.y = Math.PI * alfa / 180;
          razzo.add(razzo_propulsori);

          larghezza_razzo_temp -= larghezza_razzo/10;
          spessore_razzo_temp -= spessore_razzo/10;
          y += altezza_razzo_temp;
          i ++;
        }
        i = 0;
        y = razzo_base.position.y - altezza_razzo/2 - altezza_razzo_temp/2 - altezza_razzo_temp*(h - 1);
        larghezza_razzo_temp = larghezza_razzo;
        spessore_razzo_temp = spessore_razzo;
        altezza_razzo_temp = altezza_razzo/50;
        d ++;
      }
      alfa += 15;
    }
    if (pos == 0) {
      razzo.position.set(larghezza_shuttle/2 + larghezza_shuttle/2, razzo.position.y + altezza_shuttle/15, -spessore_shuttle*2);
    } else {
      razzo.position.set(-(larghezza_shuttle/2 + larghezza_shuttle/2), razzo.position.y + altezza_shuttle/15, -spessore_shuttle*2);
    }
  }

  function Update() {
    requestAnimationFrame(Update);
    controls.update();
    stats.update();

    Render();
  }

  function Render() {
    renderer.render(scene, camera);
    //Launch();
    //Flames_animation();
  }


  Start();
  Update();

  </script>
</body>
</html>
